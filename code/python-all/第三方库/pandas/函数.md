# 函数

- [函数](#函数)
  - [pandas](#pandas)
    - [读取数据](#读取数据)
    - [read\_excel()](#read_excel)
  - [Series](#series)
    - [isin()](#isin)
  - [DataFrame](#dataframe)
    - [isin()](#isin-1)
    - [copy()](#copy)
    - [to\_excel()](#to_excel)
    - [apply()](#apply)
    - [map()](#map)
    - [fillna()](#fillna)
      - [基本语法](#基本语法)
      - [常用填充方式示例](#常用填充方式示例)
        - [1. **用固定值填充**](#1-用固定值填充)
        - [2. **列定制填充**](#2-列定制填充)
        - [3. **向前/向后填充**](#3-向前向后填充)
        - [4. **填充统计量**](#4-填充统计量)
        - [5. **限制填充次数**](#5-限制填充次数)

## pandas

### 读取数据

|函数 |说明|
|--|--|
|pd.read_csv(filename) |读取 CSV 文件；|
|pd.read_excel(filename) |读取 Excel 文件；|
|pd.read_sql(query, connection_object) |从 SQL 数据库读取数据；|
|pd.read_json(json_string) |从 JSON 字符串中读取数据；|
|pd.read_html(url) |从 HTML 页面中读取数据。|

```py
import pandas as pd

# 从 CSV 文件中读取数据
df = pd.read_csv('data.csv')

# 从 Excel 文件中读取数据
df = pd.read_excel('data.xlsx')

# 从 SQL 数据库中读取数据
import sqlite3
conn = sqlite3.connect('database.db')
df = pd.read_sql('SELECT * FROM table_name', conn)

# 从 JSON 字符串中读取数据
json_string = '{"name": "John", "age": 30, "city": "New York"}'
df = pd.read_json(json_string)

# 从 HTML 页面中读取数据
url = 'https://www.runoob.com'
dfs = pd.read_html(url)
df = dfs[0] # 选择第一个数据框
```

### read_excel()

`pd.read_excel()` 方法用于从 Excel 文件中读取数据并加载为 `DataFrame`。它支持读取 `.xls` 和 `.xlsx` 格式的文件。

语法：`pandas.read_excel(io, sheet_name=0, *, header=0, names=None, index_col=None, usecols=None, dtype=None, engine=None, converters=None, true_values=None, false_values=None, skiprows=None, nrows=None, na_values=None, keep_default_na=True, na_filter=True, verbose=False, parse_dates=False, date_parser=<no_default>, date_format=None, thousands=None, decimal='.', comment=None, skipfooter=0, storage_options=None, dtype_backend=<no_default>, engine_kwargs=None)`

参数说明：

- io：这是必需的参数，指定了要读取的 Excel 文件的路径或文件对象。
- sheet_name=0：指定要读取的工作表名称或索引。默认为0，即第一个工作表。
- header=0：指定用作列名的行。默认为0，即第一行。
- names=None：用于指定列名的列表。如果提供，将覆盖文件中的列名。
- index_col=None：指定用作行索引的列。可以是列的名称或数字。
- usecols=None：指定要读取的列。可以是列名的列表或列索引的列表。
- dtype=None：指定列的数据类型。可以是字典格式，键为列名，值为数据类型。
- engine=None：指定解析引擎。默认为None，pandas 会自动选择。
- converters=None：用于转换数据的函数字典。
- true_values=None：指定应该被视为布尔值True的值。
- false_values=None：指定应该被视为布尔值False的值。
- skiprows=None：指定要跳过的行数或要跳过的行的列表。
- nrows=None：指定要读取的行数。
- `na_values=None`
  - 除了默认的值，额外的应该被视为缺失值的值。
  - 数据类型：`str, list-like, or dict, default None`
  - 如果传递了 `dict`，则指定每列的 `NA` 值。
  - 默认值：`'', '#N/A', '#N/A N/A', '#NA', '-1.#IND', '-1.#QNAN', '-NaN', '-nan', '1.#IND', '1.#QNAN', '<NA>', 'N/A', 'NA', 'NULL', 'NaN', 'n/a', 'nan', 'null'`
- `keep_default_na=True`
  - 指定是否要将默认的缺失值（例如NaN）解析为 `NA`。
  - 与 `na_values` 的关系
    - `keep_default_na` 为 `True`
      - `na_values` 不为 `None`，则将默认的缺失值和 `na_values` 解析为 NA 值
      - `na_values` 为 `None`，则只解析默认的缺失值
    - `keep_default_na` 为 `False`
      - `na_values` 不为 `None`，则只解析 `na_values` 里面的值
      - `na_values` 为 `None`，不解析
  - 如果 `na_filter` 为 `False`，则不会解析，会忽略掉 `keep_default_na` 和 `na_values`
- `na_filter=True`
  - 指定是否要将数据转换为NA。
  - 设置为 `False` 则不转换。在能确保数据没有 `N/A` 时使用能提高性能
- verbose=False：指定是否要输出详细的进度信息。
- parse_dates=False：指定是否要解析日期。
- `date_parser=<no_default>`：用于解析日期的函数。
- date_format=None：指定日期的格式。
- thousands=None：指定千位分隔符。
- decimal='.'：指定小数点字符。
- comment=None：指定注释字符。
- skipfooter=0：指定要跳过的文件末尾的行数。
- storage_options=None：用于云存储的参数字典。
- `dtype_backend=<no_default>`：指定数据类型后端。
- engine_kwargs=None：传递给引擎的额外参数字典。

如果 data.xlsx 文件中有多个表单，可以通过指定 `sheet_name` 来读取特定表单的数据

```py
import pandas as pd

# 读取默认的第一个表单
df = pd.read_excel('data.xlsx')

# 读取指定表单的内容（表单名称）
df = pd.read_excel('data.xlsx', sheet_name='Sheet1')

# 读取多个表单，返回一个字典
dfs = pd.read_excel('data.xlsx', sheet_name=['Sheet1', 'Sheet2'])

# 自定义列名并跳过前两行
df = pd.read_excel('data.xlsx', header=None, names=['A', 'B', 'C'], skiprows=2)
print(df)
```

## Series

### isin()

语法：`Series.isin(values)`

作用：判断 `Series` 中的元素是否包含在 `list` 或 `set` 中。返回一个 `boolean` 类型的 `Series`

例子：

```py
>>> s = pd.Series(['llama', 'cow', 'llama', 'beetle', 'llama',
...                'hippo'], name='animal')
>>> s.isin(['cow', 'llama'])
0     True
1     True
2     True
3    False
4     True
5    False
Name: animal, dtype: bool
```

字符串 和 整数 是不同的，因此不可比较：

```py
>>> pd.Series([1]).isin(['1'])
0    False
dtype: bool
>>> pd.Series([1.1]).isin(['1.1'])
0    False
dtype: bool
```

## DataFrame

### isin()

### copy()

语法：`DataFrame.copy(deep=True)`

复制 DataFrame

### to_excel()

`to_excel()` 方法用于将 DataFrame 写入 Excel 文件，支持 `.xls` 和 `.xlsx` 格式。

语法：`DataFrame.to_excel(excel_writer, *, sheet_name='Sheet1', na_rep='', float_format=None, columns=None, header=True, index=True, index_label=None, startrow=0, startcol=0, engine=None, merge_cells=True, inf_rep='inf', freeze_panes=None, storage_options=None, engine_kwargs=None)`

参数说明：

- excel_writer：这是必需的参数，指定了要写入的 Excel 文件路径或文件对象。
- sheet_name='Sheet1'：指定写入的工作表名称，默认为 'Sheet1'。
- na_rep=''：指定在 Excel 文件中表示缺失值（NaN）的字符串，默认为空字符串。
- float_format=None：指定浮点数的格式。如果为 None，则使用 Excel 的默认格式。
- columns=None：指定要写入的列。如果为 None，则写入所有列。
- header=True：指定是否写入列名作为第一行。如果为 False，则不写入列名。
- index=True：指定是否写入索引作为第一列。如果为 False，则不写入索引。
- index_label=None：指定索引列的标签。如果为 None，则不写入索引标签。
- startrow=0：指定开始写入的行号，默认从第0行开始。
- startcol=0：指定开始写入的列号，默认从第0列开始。
- engine=None：指定写入 Excel 文件时使用的引擎，默认为 None，pandas 会自动选择。
- merge_cells=True：指定是否合并单元格。如果为 True，则合并具有相同值的单元格。
- inf_rep='inf'：指定在 Excel 文件中表示无穷大值的字符串，默认为 'inf'。
- freeze_panes=None：指定冻结窗格的位置。如果为 None，则不冻结窗格。
- storage_options=None：用于云存储的参数字典。
- engine_kwargs=None：传递给引擎的额外参数字典。

```py
import pandas as pd

# 创建一个简单的 DataFrame
df = pd.DataFrame({
'Name': ['Alice', 'Bob', 'Charlie'],
'Age': [25, 30, 35],
'City': ['New York', 'Los Angeles', 'Chicago']
})

# 将 DataFrame 写入 Excel 文件，写入 'Sheet1' 表单
df.to_excel('output.xlsx', sheet_name='Sheet1', index=False)
```

### apply()

沿 `DataFrame` 的轴应用函数

语法：`DataFrame.apply(func, axis=0, raw=False, result_type=None, args=(), by_row='compat', engine='python', engine_kwargs=None, **kwargs)`

参数说明：

- func: function
  - Function to apply to each column or row.

- axis: {0 or ‘index’, 1 or ‘columns’}, **default 0**
  - Axis along which the function is applied:
  - 0 or ‘index’: apply function to each column.
  - 1 or ‘columns’: apply function to each row.

Examples:

```py
df = pd.DataFrame([[4, 9]] * 3, columns=['A', 'B'])
df
   A  B
0  4  9
1  4  9
2  4  9
```

Using a numpy universal function (in this case the same as np.sqrt(df)):

```py
df.apply(np.sqrt)
     A    B
0  2.0  3.0
1  2.0  3.0
2  2.0  3.0
```

Using a reducing function on either axis:

```py
df.apply(np.sum, axis=0)
A    12
B    27
dtype: int64

df.apply(np.sum, axis=1)
0    13
1    13
2    13
dtype: int64
```

### map()

将函数应用于 `Dataframe` 的每一个元素

语法：`DataFrame.map(func, na_action=None, **kwargs)`

参数说明：

- func 为一个接收元素和返回元素的函数
- `na_action: {None, 'ignore'}`，默认为 `None` 。如果为`ignore`，则忽略 NaN 值，而不将它们传递给 func。
- **kwargs: 传递给 func 的额外关键字参数。

示例:

```py
df = pd.DataFrame([[1, 2.12], [3.356, 4.567]])
df
       0      1
0  1.000  2.120
1  3.356  4.567

df.map(lambda x: len(str(x)))
   0  1
0  3  4
1  5  5
```

可以忽略 `NA` 值：

```py
df_copy = df.copy()
df_copy.iloc[0, 0] = pd.NA
df_copy.map(lambda x: len(str(x)), na_action='ignore')
     0  1
0  NaN  4
1  5.0  5
```

也可以使用不是 `lambda` 函数的函数：

```py
df.map(round, ndigits=1)
     0    1
0  1.0  2.1
1  3.4  4.6
```

### fillna()

`fillna()` 是 pandas 中用于填充缺失值（NaN 或 None）的核心函数，支持多种灵活的填充策略。

#### 基本语法

```python
DataFrame.fillna(
    value=None,       # 填充值（标量、字典、Series或DataFrame）
    method=None,      # 填充方法：'ffill'（向前填充）、'bfill'（向后填充）
    axis=None,        # 填充轴：0（行）、1（列）
    inplace=False,    # 是否原地修改
    limit=None,       # 最大连续填充数量
    downcast=None     # 向下转换数据类型
)
```

参数说明：

| 参数      | 说明                                                                 |
|-----------|----------------------------------------------------------------------|
| `value`   | 支持标量、字典（列名→值）、Series（索引对齐）、DataFrame（行列对齐） |
| `method`  | `'ffill'`/`'pad'`（向前填充），`'bfill'`/`'backfill'`（向后填充）<br>  向前和向后填充 的意思是指用 上一个或下一个**有效值**填充当前值   |
| `axis`    | `0` 或 `'index'`（按行填充），`1` 或 `'columns'`（按列填充）         |
| `limit`   | 允许**连续填充**的最大NaN数量                                            |
| `inplace` | `True` 时直接修改原对象，返回 `None`                                 |

注意：`value` 参数和 `method` 参数不能同时使用。

#### 常用填充方式示例

##### 1. **用固定值填充**

```python
import pandas as pd
import numpy as np

data = {'A': [1, np.nan, 3], 'B': [np.nan, 5, np.nan]}
df = pd.DataFrame(data)

# 用0填充所有NaN
df_filled = df.fillna(0)
```

结果：

```txt
     A    B
0  1.0  0.0
1  0.0  5.0
2  3.0  0.0
```

##### 2. **列定制填充**

```python
# 不同列用不同值填充
df_filled = df.fillna({'A': 100, 'B': 200})
```

结果：

```txt
     A      B
0  1.0  200.0
1  100.0   5.0
2  3.0  200.0
```

##### 3. **向前/向后填充**

```python
# 向前填充（用上一个有效值）
df_ffill = df.fillna(method='ffill')

# 向后填充（用下一个有效值）
df_bfill = df.fillna(method='bfill')
```

向前填充结果：

```txt
     A    B
0  1.0  NaN # 前面无有效值，所以填充不了
1  1.0  5.0
2  3.0  5.0
```

##### 4. **填充统计量**

```python
# 用列均值填充
df_mean = df.fillna(df.mean())
```

结果（假设B列均值为5）：

```txt
     A    B
0  1.0  5.0
1  2.0  5.0  # A列均值=(1+3)/2=2
2  3.0  5.0
```

##### 5. **限制填充次数**

```python
data = {'A': [np.nan, np.nan, 3, np.nan]}
df = pd.DataFrame(data)

# 最多填充1个连续NaN
df_filled = df.fillna(method='ffill', limit=1)
```

结果：

```txt
     A
0  NaN  # 第一个NaN不填充（前面无值）
1  NaN  # 第二个NaN可填充但是前一个值为 NaN，不是有效值，不填充
2  3.0
3  3.0  # 正常填充
```
