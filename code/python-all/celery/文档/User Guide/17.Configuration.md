# Configuration

- [Configuration](#configuration)
  - [Task result backend settings](#task-result-backend-settings)
    - [result\_backend](#result_backend)
    - [result\_extended](#result_extended)
  - [Database backend settings](#database-backend-settings)
    - [Database URL Examples](#database-url-examples)
    - [database\_create\_tables\_at\_setup](#database_create_tables_at_setup)
    - [database\_table\_schemas](#database_table_schemas)
    - [database\_table\_names](#database_table_names)
  - [Worker](#worker)
    - [worker\_log\_color](#worker_log_color)
    - [worker\_log\_format](#worker_log_format)
    - [worker\_task\_log\_format](#worker_task_log_format)
    - [worker\_redirect\_stdouts](#worker_redirect_stdouts)
    - [worker\_redirect\_stdouts\_level](#worker_redirect_stdouts_level)

## Task result backend settings

### result_backend

默认情况下不启用 result backend。

`result_backend` 用于指定用什么 `backend` 存储 task 的结果， `backend` 可以是以下的类型：

- `rpc`
  - 发送 task 结果到消息队列
- `database`
  - `SQLAlchemy` 支持的关系型数据库
- `redis`
- `mongodb`

> backend 和 result_backend 的区别：
>
> backend 是以前版本的配置，已经废弃了，现在应该使用 result_backend。如果配置了 backend，它会被当做 result_backend

### result_extended

默认值: False

作用：是否额外存储 `name, args, kwargs, worker, retries, queue, delivery_info` 数据到 backend 中

取值：

- False
  - 只存储 `task_id, status, result, date_done, traceback`
- True
  - 额外存储 `name, args, kwargs, worker, retries, queue, delivery_info`

## Database backend settings

### Database URL Examples

使用 database 作为 backend，需要给 `result_backend` 设置 `db+` 为前缀的连接数据库的字符串：

`result_backend = 'db+scheme://user:password@host:port/dbname'`

具体例子:

```py
# sqlite (filename)
result_backend = 'db+sqlite:///results.sqlite'

# mysql
result_backend = 'db+mysql://scott:tiger@localhost/foo'

# postgresql
result_backend = 'db+postgresql://scott:tiger@localhost/mydatabase'

# oracle
result_backend = 'db+oracle://scott:tiger@127.0.0.1:1521/sidname'
```

### database_create_tables_at_setup

默认值：True

取值：

- `True` ：Celery 会在启动时在数据库创建表
- `False` ：Celery 会懒创建数据库表，直到第一个 task 执行时才会创建

> 说明:  
> 在 5.5.0 版本添加。  
> 在 5.5.0 版本之前，表格都是懒创建的，等同于设置 `database_create_tables_at_setup` 为 `False`

### database_table_schemas

默认值: {} (empty mapping).

自定义存储 task 结果的表的 `schema` ：

```py
# use custom schema for the database result backend.
database_table_schemas = {
    'task': 'qc',
    'group': 'qc',
}
```

### database_table_names

默认值: {} (empty mapping).

自定义存储 task 结果的表的**名称**：

```py
# use custom table names for the database result backend.
database_table_names = {
    'task': 'myapp_taskmeta',
    'group': 'myapp_groupmeta',
}
```

## Worker

### worker_log_color

作用：控制终端打印的日志是否显示颜色

默认值： `True`

### worker_log_format

作用：worker 的日志的格式

默认值：`"[%(asctime)s: %(levelname)s/%(processName)s] %(message)s"`

[格式参考](../../../../python/文档/标准库/通用操作系统服务/logging.md#logrecord-格式)

### worker_task_log_format

作用：Task 打印的日志的格式

默认值：`"[%(asctime)s: %(levelname)s/%(processName)s]%(task_name)s[%(task_id)s]: %(message)s"`

### worker_redirect_stdouts

作用：如果为 `True`， `stdout` 和 `stderr` 会重定向到当前的 `logger` 。即使用 `print()` 输出的内容会打印到 `worker` 的日志里面，不会打印到 `task` 的日志里面

默认值： `True`

### worker_redirect_stdouts_level

作用：记录 `stdout` 和 `stderr` 的内容的日志的 level。

取值：DEBUG, INFO, WARNING, ERROR, or CRITICAL

默认值： `WARNING`
