# 构建生产版本

- [构建生产版本](#构建生产版本)
  - [公共基础路径](#公共基础路径)
  - [vue](#vue)

## 公共基础路径

指定 `base` 选项来设置应用的公共基础路径。

由 JS 引入的资源 URL，CSS 中的 `url()` 引用以及 `.html` 文件中引用的资源在构建过程中都会自动调整，以适配此选项。

例如，如果应用部署在 `https://www.example.com/my-app/`，则应将 `base` 设置为 `/my-app/`。

```js
import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue'
export default defineConfig({
  plugins: [vue()],
  base: '/my-app/', // 设置公共基础路径
})
```

根据环境设置 `base`

```js
import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue'
export default defineConfig(({ mode }) => {
  return {
    plugins: [vue()],
    base: mode === 'production' ? '/my-app/' : '/',
    // or
    base: process.env.NODE_ENV === 'production' ? '/my-app/' : '/',

    // 下面是错误的写法，因为这时候还没有加载配置的环境变量
    base: import.meta.env.PROD ? '/my-app/' : '/', // ❌
  }
})
```

## vue

- vue router 动态导入的文件会被单独打包成 chunk
- defineAsyncComponent 异步组件会被单独打包成 chunk
- await import() 动态导入的文件会被单独打包成 chunk
- 其他未动态导入的文件会被打包到主包中
