# 加载图片

- [加载图片](#加载图片)
  - [加载图片的方式](#加载图片的方式)
    - [图片放置建议](#图片放置建议)
  - [懒加载图片](#懒加载图片)
    - [使用 vue-lazyload](#使用-vue-lazyload)
      - [参数说明](#参数说明)

## 加载图片的方式

在 Vue 项目中加载本地 assets 文件夹的图片，有几种常见方法：

1、**在模板中直接引用（适用于静态图片）**

```vue
<template>
  <div>
    <!-- 相对路径 -->
    <img src="./assets/logo.png" alt="Logo">
    
    <!-- 使用 @ 别名（推荐） -->
    <img src="@/assets/logo.png" alt="Logo">
  </div>
</template>
```

2、**使用 require 或 import（动态绑定）**

```vue
<template>
  <div>
    <!-- 方法1：require -->
    <img :src="require('@/assets/logo.png')" alt="Logo">
    
    <!-- 方法2：import -->
    <img :src="logo" alt="Logo">
    
    <!-- 动态路径 -->
    <img :src="require(`@/assets/${imageName}.png`)" alt="Logo">
  </div>
</template>

<script>
// 方法2的import方式
import logo from '@/assets/logo.png'

export default {
  data() {
    return {
      logo: logo,
      imageName: 'logo'
    }
  }
}
</script>
```

3、**CSS/SCSS 中引用**

```vue
<template>
  <div class="banner"></div>
</template>

<style scoped>
/* 相对路径 */
.banner {
  background-image: url('./assets/banner.jpg');
  background-size: cover;
}

/* 使用 @ 别名 */
.banner {
  background-image: url('@/assets/banner.jpg');
  background-size: cover;
}

/* 在 SCSS 中 */
.banner {
  background-image: url('~@/assets/banner.jpg');
  background-size: cover;
}
</style>
```

4、**在 JavaScript 中动态设置**

```vue
<template>
  <div :style="{ backgroundImage: `url(${bgImage})` }"></div>
  <img :src="imgUrl" alt="Dynamic Image">
</template>

<script>
export default {
  data() {
    return {
      // 使用 require
      bgImage: require('@/assets/bg.jpg'),
      
      // 或者使用 import
      imgUrl: null
    }
  },
  created() {
    // 动态加载
    this.imgUrl = require(`@/assets/${this.getImageName()}.png`)
  },
  methods: {
    getImageName() {
      return 'logo'
    }
  }
}
</script>
```

5、**加载放在 public 文件夹图片**

如果图片在 `public` 文件夹中，可以直接使用绝对路径：

```vue
<template>
  <img src="/img/logo.png" alt="Logo">
</template>
```

### 图片放置建议

1. **小图片、图标**：放在 `assets` 文件夹，会被 webpack 处理
2. **大图片、用户上传的图片**：放在 `public` 文件夹，直接引用
3. **动态图片路径**：使用 `require` 或动态 `import`
4. **静态图片**：直接使用 `@/assets/` 路径

**示例项目结构：**

```txt
src/
  assets/
    images/
      logo.png
      banner.jpg
    icons/
      home.svg
  components/
    MyComponent.vue
public/
  img/
    large-bg.jpg  # 大图片放这里
```

选择哪种方式取决于你的具体需求：

- 静态图片 → 直接使用路径
- 动态图片 → 使用 require
- CSS 背景图 → 使用 url() 语法
- 需要 webpack 处理（压缩、hash）→ 放在 assets
- 不需要处理的大文件 → 放在 public

## 懒加载图片

懒加载图片可以提升页面加载性能，常用的方法有：

1. 使用第三方库，如 `vue-lazyload`
2. 使用原生的 `loading="lazy"` 属性（现代浏览器支持）
3. 使用 `Intersection Observer API` 自定义懒加载逻辑

### 使用 vue-lazyload

[github 地址](https://github.com/hilongjw/vue-lazyload)

安装 `vue-lazyload`：

```bash
npm install vue-lazyload
```

在 `main.js` 加载 `VueLazyload`：

```js
import Vue from 'vue'
import App from './App.vue'
import VueLazyload from 'vue-lazyload'

Vue.use(VueLazyload)

// or with options
const loadimage = require('./assets/loading.gif')
const errorimage = require('./assets/error.gif')

Vue.use(VueLazyload, {
  preLoad: 1.3,
  error: errorimage,
  loading: loadimage,
  attempt: 1
})

new Vue({
  el: 'body',
  components: {
    App
  }
})
```

在 template 通过 `v-lazy` 指令加载图片:

```vue
<template>
  <!-- 示例 1：图片列表懒加载 (最常见场景) -->
  <ul>
    <li v-for="img in list">
      <img v-lazy="img.src" >
    </li>
  </ul>

  <!-- 示例 2：单张图片懒加载 -->
  <div>
    <img v-lazy="'@/assets/large-image.jpg'" alt="Lazy Loaded Image">
  </div>

  <!-- 示例 3：背景图懒加载 -->
  <div class="section">
    <h2>3. 背景图懒加载</h2>
    <!-- 注意：背景图懒加载需要使用 v-lazy:background-image，且容器必须有高度 -->
    <div
      v-lazy:background-image="'https://picsum.photos/600/300?image=1005'"
      class="lazy-background"
    >
      <p>这个div的背景图是懒加载的。</p>
    </div>
  </div>
</template>
```

#### 参数说明

Vue-Lazyload 的参数（配置项）主要分为 **核心配置**、**高级配置**和**事件监听**三大类。下表整理了所有核心参数的作用、类型和典型使用场景：

| 参数名 | 类型 | 默认值 | 作用与描述 | 使用场景/建议 |
| :--- | :--- | :--- | :--- | :--- |
| **`loading`** | `String` | `-` | **加载中的占位图**路径。图片开始加载但未完成时显示。 | **必配项**。建议使用极小体积（如1px灰色）的本地图片或base64，防止占位图本身成为负担。 |
| **`error`** | `String` | `-` | **加载失败的占位图**路径。图片加载失败时显示。 | **强烈建议配置**。提升出错时的用户体验，避免显示“破碎”图标。 |
| **`attempt`** | `Number` | `3` | **图片加载失败后的重试次数**。每次重试间隔会递增。 | 网络环境较差或图片服务器不稳定的项目可适当增加（如 `3`）。 |
| **`preLoad`** | `Number` | `1.3` | **预加载高度比例**。值为 `1.3` 表示在图片进入视口**前1.3倍视口高度**时就开始加载。 | 希望加载更平顺可调高（如 `1.5`）；想严格按需加载可调低（如 `1.0`）。 |
| **`listenEvents`** | `Array` | `['scroll', 'wheel', ...]` | 用于触发懒加载检查的**事件列表**。 | 页面有复杂动画或滚动非窗口容器时，可增加 `'resize'`, `'animationend'`, `'transitionend'` 等事件。 |
| **`adapter`** | `Object` | `{}` | **适配器对象**。允许在加载过程各节点插入自定义逻辑。 | **高级需求**，如修改图片URL、添加日志、集成第三方SDK等。 |
| **`filter`** | `Object` | `{}` | **过滤器对象**。在加载前对图片URL或状态进行预处理。 | **高级需求**，如统一添加水印参数、根据网络状况切换图片质量等。 |
| **`lazyComponent`** | `Boolean` | `false` | **是否启用组件懒加载**。开启后可使用 `<lazy-component>` 标签。 | 需要懒加载整个组件（而不仅仅是图片）时开启。 |
| **`dispatchEvent`** | `Boolean` | `false` | 是否在图片加载后**触发自定义事件** `loaded` 或 `error`。 | 需要监听图片加载状态并执行额外JS逻辑时开启。 |
| **`throttleWait`** | `Number` | `200` | **事件触发节流等待时间（毫秒）**，用于优化性能。 | 页面滚动事件非常频繁导致性能问题时，可适当增加此值。 |
| **`observer`** | `Boolean` | `false` | **是否启用 IntersectionObserver**（现代浏览器）。 | 在支持的浏览器上能获得更好的性能和更简洁的实现，建议在移动端或现代浏览器项目中开启。 |
| **`observerOptions`** | `Object` | `{}` | 传递给 **IntersectionObserver** 的配置选项。 | 需要精细控制观察行为时使用，如 `rootMargin: '30px'` 可提前30px观察。 |
| **`silent`** | `Boolean` | `true` | **是否禁止在控制台输出调试信息**（如Warn）。 | 开发调试时可设为 `false` 以查看插件运行状态。 |

1、**`loading` 与 `error`**

```javascript
Vue.use(VueLazyload, {
  loading: '/static/loading.svg', // 推荐使用内联SVG或极小位图
  error: '/static/error.jpg'      // 加载失败时展示的友好图片
})
```

**建议**：`loading` 图尽量使用CSS或SVG生成，或压缩到1KB以下，避免其成为新的性能瓶颈。

2、**`preLoad`（控制加载时机）**

```javascript
Vue.use(VueLazyload, {
  preLoad: 1.3, // 默认值，适度提前加载
  // preLoad: 0.7, // 更接近视口再加载，更省流量但可能看到“加载过程”
  // preLoad: 2.0, // 很早开始加载，体验流畅但可能加载了用户永远不看的内容
})
```

3、**`listenEvents`（应对复杂场景）**

如果你的页面滚动不是发生在 `window` 上，或者有复杂的动画，可能需要扩展监听事件。

```javascript
Vue.use(VueLazyload, {
  listenEvents: ['scroll', 'wheel', 'mousewheel', 'resize', 'animationend', 'transitionend']
})
```

4、**`adapter` 与 `filter`（高级扩展）**

这两个参数允许你在加载生命周期的特定节点“注入”自定义代码。

```javascript
Vue.use(VueLazyload, {
  // 过滤器：在加载前动态修改图片URL
  filter: {
    progressive(listener, options) {
      // 为图片URL添加渐进式加载参数（假设后端支持）
      const isCDN = listener.src.includes('cdn.domain.com')
      if(isCDN) {
        listener.src += '?format=webp&quality=80' // 动态添加格式和压缩参数
      }
    }
  },
  // 适配器：在加载过程中的不同阶段执行操作
  adapter: {
    loaded({ el, src }) {
      // 图片加载成功后，添加一个淡入动画类
      el.classList.add('fade-in')
      // 可以在这里发送图片加载成功的统计日志
      console.log(`图片加载成功: ${src}`)
    }
  }
})
```

5、**启用 `observer`（现代浏览器性能优化）**

在支持 `IntersectionObserver` API的浏览器中，开启此项能以更高性能的方式实现懒加载检测。

```javascript
Vue.use(VueLazyload, {
  observer: true,
  observerOptions: {
    rootMargin: '50px', // 观察区向外扩展50px
    threshold: 0.1 // 当目标元素10%可见时触发
  }
})
```
