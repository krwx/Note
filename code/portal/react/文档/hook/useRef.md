# useRef

- [useRef](#useref)
  - [è¯­æ³•](#è¯­æ³•)
  - [ç”¨æ³•](#ç”¨æ³•)
    - [æ¸…é™¤å®šæ—¶å™¨](#æ¸…é™¤å®šæ—¶å™¨)
    - [é€šè¿‡ ref æ“ä½œ DOM](#é€šè¿‡-ref-æ“ä½œ-dom)
    - [é¿å…é‡å¤åˆ›å»º ref çš„å†…å®¹](#é¿å…é‡å¤åˆ›å»º-ref-çš„å†…å®¹)
  - [ä¸è¦åœ¨æ¸²æŸ“æœŸé—´å†™å…¥æˆ–è€…è¯»å– ref.current](#ä¸è¦åœ¨æ¸²æŸ“æœŸé—´å†™å…¥æˆ–è€…è¯»å–-refcurrent)

`useRef` æ˜¯ä¸€ä¸ª React Hookï¼Œå®ƒèƒ½è®©ä½ å¼•ç”¨ä¸€ä¸ªä¸éœ€è¦æ¸²æŸ“çš„å€¼ã€‚

**æ”¹å˜ ref ä¸ä¼šè§¦å‘é‡æ–°æ¸²æŸ“ã€‚**

**ä¸ºä»€ä¹ˆä½¿ç”¨ useRef å­˜å‚¨ä¸éœ€è¦æ¸²æŸ“çš„å€¼ï¼Œè€Œä¸ç›´æ¥å£°æ˜ä¸€ä¸ªå˜é‡å­˜å‚¨æ•°æ®**ï¼Ÿ ç†ç”±å¦‚ä¸‹ï¼š

- ä½ å¯ä»¥åœ¨é‡æ–°æ¸²æŸ“ä¹‹é—´ å­˜å‚¨ä¿¡æ¯ï¼ˆä¸åƒæ˜¯æ™®é€šå¯¹è±¡ï¼Œæ¯æ¬¡æ¸²æŸ“éƒ½ä¼šé‡ç½®ï¼‰ã€‚
- æ”¹å˜å®ƒ ä¸ä¼šè§¦å‘é‡æ–°æ¸²æŸ“ï¼ˆä¸åƒæ˜¯ state å˜é‡ï¼Œä¼šè§¦å‘é‡æ–°æ¸²æŸ“ï¼‰ã€‚
- å¯¹äºä½ çš„ç»„ä»¶çš„æ¯ä¸ªå‰¯æœ¬æ¥è¯´ï¼Œè¿™äº›ä¿¡æ¯éƒ½æ˜¯æœ¬åœ°çš„ï¼ˆä¸åƒæ˜¯å¤–é¢çš„å˜é‡ï¼Œæ˜¯å…±äº«çš„ï¼‰ã€‚

æ”¹å˜ `ref` ä¸ä¼šè§¦å‘é‡æ–°æ¸²æŸ“ã€‚ è¿™æ„å‘³ç€ `ref` æ˜¯å­˜å‚¨ä¸€äº›ä¸å½±å“ç»„ä»¶è§†å›¾è¾“å‡ºçš„ä¿¡æ¯çš„å®Œç¾é€‰æ‹©ã€‚

æ”¹å˜ `ref` ä¸ä¼šè§¦å‘é‡æ–°æ¸²æŸ“ï¼Œæ‰€ä»¥ `ref` ä¸é€‚åˆç”¨äºå­˜å‚¨æœŸæœ›æ˜¾ç¤ºåœ¨å±å¹•ä¸Šçš„ä¿¡æ¯ã€‚

## è¯­æ³•

`useRef(initialValue)`ï¼šåœ¨ä½ ç»„ä»¶çš„é¡¶å±‚è°ƒç”¨ useRef å£°æ˜ä¸€ä¸ª refã€‚

å‚æ•°

- `initialValue`ï¼š `ref` å¯¹è±¡çš„ `current` å±æ€§çš„åˆå§‹å€¼ã€‚å¯ä»¥æ˜¯ä»»æ„ç±»å‹çš„å€¼ã€‚è¿™ä¸ªå‚æ•°ä¼šé¦–æ¬¡æ¸²æŸ“åè¢«å¿½ç•¥ã€‚

è¿”å›å€¼

- `useRef` è¿”å›ä¸€ä¸ªåªæœ‰ä¸€ä¸ª `current` å±æ€§çš„å¯¹è±¡:
  - `current`ï¼šæœ€åˆï¼Œå®ƒè¢«è®¾ç½®ä¸ºä½ ä¼ é€’çš„ `initialValue`ã€‚ä¹‹åä½ å¯ä»¥æŠŠå®ƒè®¾ç½®ä¸ºå…¶ä»–å€¼ã€‚
  - å¦‚æœä½ æŠŠ ref å¯¹è±¡**ä½œä¸ºä¸€ä¸ª JSX èŠ‚ç‚¹çš„ ref å±æ€§**ä¼ é€’ç»™ Reactï¼ŒReact å°†ä¸ºå®ƒè®¾ç½® current å±æ€§ã€‚

åœ¨åç»­çš„æ¸²æŸ“ä¸­ï¼ŒuseRef å°†è¿”å›åŒä¸€ä¸ªå¯¹è±¡ã€‚

æ³¨æ„äº‹é¡¹

- ä½ å¯ä»¥ä¿®æ”¹ `ref.current` å±æ€§ï¼Œæ˜¯å¯å˜çš„ã€‚
  - ç„¶è€Œï¼Œå¦‚æœå®ƒæŒæœ‰ä¸€ä¸ªç”¨äºæ¸²æŸ“çš„å¯¹è±¡ï¼ˆä¾‹å¦‚ï¼Œä½ çš„ state çš„ä¸€éƒ¨åˆ†ï¼‰ï¼Œé‚£ä¹ˆä½ å°±ä¸åº”è¯¥ä¿®æ”¹è¿™ä¸ªå¯¹è±¡ã€‚
- å½“ä½ æ”¹å˜ `ref.current` å±æ€§æ—¶ï¼Œ**React ä¸ä¼šé‡æ–°æ¸²æŸ“ä½ çš„ç»„ä»¶**ã€‚
  - React ä¸çŸ¥é“ä½ ä½•æ—¶æ”¹å˜å®ƒï¼Œå› ä¸º ref æ˜¯ä¸€ä¸ªæ™®é€šçš„ JavaScript å¯¹è±¡ã€‚
- é™¤äº† åˆå§‹åŒ– å¤–ä¸è¦åœ¨æ¸²æŸ“æœŸé—´å†™å…¥ æˆ–è€…è¯»å– `ref.current`ã€‚è¿™ä¼šä½¿ä½ çš„ç»„ä»¶çš„è¡Œä¸ºä¸å¯é¢„æµ‹ã€‚
- åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼ŒReact å°†ä¼š **è°ƒç”¨ä¸¤æ¬¡ç»„ä»¶æ–¹æ³•**ï¼Œè¿™æ˜¯ä¸ºäº† å¸®åŠ©ä½ å‘ç°æ„å¤–çš„é—®é¢˜ã€‚è¿™åªæ˜¯å¼€å‘æ¨¡å¼ä¸‹çš„è¡Œä¸ºï¼Œä¸å½±å“ç”Ÿäº§æ¨¡å¼ã€‚æ¯ä¸ª ref å¯¹è±¡å°†ä¼šåˆ›å»ºä¸¤æ¬¡ï¼Œä½†æ˜¯å…¶ä¸­ä¸€ä¸ªç‰ˆæœ¬å°†è¢«ä¸¢å¼ƒã€‚

## ç”¨æ³•

### æ¸…é™¤å®šæ—¶å™¨

å¯ä»¥ä½¿ç”¨æ™®é€šå˜é‡å­˜å‚¨è®¡æ—¶å™¨çš„ id ï¼Œä½†æ˜¯å‰ææ˜¯ç»„ä»¶æ°¸è¿œä¸ä¼šé‡å†™æ¸²æŸ“ã€‚ä¸€æ—¦é‡æ–°æ¸²æŸ“ï¼Œé‚£ä¹ˆå­˜å‚¨ id çš„å˜é‡å°±ä¼šé‡ç½®ï¼Œè¿™æ ·å°±ä¸¢å¤±äº†åŸæ¥çš„è®¡æ—¶å™¨çš„ idï¼Œé‚£ä¹ˆå°±ä¸èƒ½åœæ­¢è®¡æ—¶ã€‚

ä½¿ç”¨ useRef å­˜å‚¨è®¡æ—¶å™¨çš„ idï¼Œé‚£ä¹ˆå½“ç»„ä»¶å› ä¸º setState æˆ–å…¶ä»–åŸå› é‡æ–°æ¸²æŸ“æ—¶ï¼Œid è¿˜æ˜¯ä¿å­˜ä¸‹æ¥äº†ï¼Œå¯ä»¥åœæ­¢è®¡æ—¶

```js
// è¿™é‡Œé€šè¿‡ä¸€ä¸ªè¾“å…¥æ¡†å®ç°ç»„ä»¶é‡æ–°æ¸²æŸ“
import { Button } from 'antd';
import { useRef, useState } from 'react';

export default function MyApp() {
  const [name, setName] = useState('');
  const intervalId = useRef(0);

  const startTiming = () => {
    intervalId.current = setInterval(() => {
      console.log("hello", Date.now());
    }, 1000);
  }
  const stopTiming = () => {
    clearInterval(intervalId.current);
  }

  return (
    <>
      <Button type='primary' onClick={startTiming}>start</Button>
      <Button type='primary' onClick={stopTiming}>stop</Button>
      <label>
        Name{': '}
        <input value={name} onChange={e => setName(e.target.value)} />
      </label>
    </>
  );
}
```

### é€šè¿‡ ref æ“ä½œ DOM

1. å£°æ˜ä¸€ä¸ª initial value ä¸º null çš„ ref å¯¹è±¡
2. å°†ä½ çš„ ref å¯¹è±¡ä½œä¸º ref å±æ€§ä¼ é€’ç»™ä½ æƒ³è¦æ“ä½œçš„ DOM èŠ‚ç‚¹çš„ JSX
3. å½“ React åˆ›å»º DOM èŠ‚ç‚¹å¹¶å°†å…¶æ¸²æŸ“åˆ°å±å¹•æ—¶ï¼ŒReact å°†ä¼šæŠŠ DOM èŠ‚ç‚¹è®¾ç½®ä¸ºä½ çš„ ref å¯¹è±¡çš„ `current` å±æ€§ã€‚ç°åœ¨ä½ å¯ä»¥è®¿é—® `<input>` çš„ DOM èŠ‚ç‚¹ï¼Œ

```js
import { useRef } from 'react';

export default function Form() {
  // 1. å£°æ˜ä¸€ä¸ª initial value ä¸º null çš„ ref å¯¹è±¡
  const inputRef = useRef(null);

  function handleClick() {
    // 3. æ“ä½œ DOM èŠ‚ç‚¹
    inputRef.current.focus();
  }

  return (
    <>
      // 2. å°†ä½ çš„ ref å¯¹è±¡ä½œä¸º ref å±æ€§ä¼ é€’ç»™ä½ æƒ³è¦æ“ä½œçš„ DOM èŠ‚ç‚¹çš„ JSX
      <input ref={inputRef} />
      <button onClick={handleClick}>
        Focus the input
      </button>
    </>
  );
}
```

### é¿å…é‡å¤åˆ›å»º ref çš„å†…å®¹

`React` ä¿å­˜é¦–æ¬¡çš„ `ref` åˆå§‹å€¼ï¼Œå¹¶åœ¨åç»­çš„æ¸²æŸ“ä¸­å¿½ç•¥å®ƒã€‚

```js
function Video() {
  const playerRef = useRef(new VideoPlayer());
  // ...
```

è™½ç„¶ `new VideoPlayer()` çš„ç»“æœåªä¼šåœ¨é¦–æ¬¡æ¸²æŸ“æ—¶ä½¿ç”¨ï¼Œä½†æ˜¯ä½ ä¾ç„¶åœ¨æ¯æ¬¡æ¸²æŸ“æ—¶éƒ½åœ¨è°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚  
(ä¸ªäººç†è§£æ˜¯ç»„ä»¶åˆå§‹åŒ–åï¼Œç»„ä»¶æ¯æ¬¡æ¸²æŸ“æ—¶ `ref` çš„å€¼éƒ½ä¸ä¼šå–åˆå§‹å€¼ï¼Œä½†æ˜¯ç»„ä»¶è¿˜æ˜¯ä¼šæ‰§è¡Œ `VideoPlayer()` è¿™ä¸ªæ–¹æ³•ï¼Œå°½ç®¡ `ref` ä¸ä¼šå–è¿™ä¸ªå€¼)

å¯¹ `ref` è¿›è¡Œåˆ¤ç©ºå¤„ç†æ¥é¿å…

```js
function Video() {
  const playerRef = useRef(null);
  if (playerRef.current === null) {
    playerRef.current = new VideoPlayer();
  }
  // ...
```

## ä¸è¦åœ¨æ¸²æŸ“æœŸé—´å†™å…¥æˆ–è€…è¯»å– ref.current

åœ¨ æ¸²æŸ“æœŸé—´ è¯»å–æˆ–å†™å…¥ ref ä¼šç ´åä¸€äº›é¢„æœŸè¡Œä¸ºã€‚

```js
function MyComponent() {
  // ...
  // ğŸš© ä¸è¦åœ¨æ¸²æŸ“æœŸé—´å†™å…¥ ref
  myRef.current = 123;
  // ...
  // ğŸš© ä¸è¦åœ¨æ¸²æŸ“æœŸé—´è¯»å– ref
  return <h1>{myOtherRef.current}</h1>;
}
```

**åœ¨ äº‹ä»¶å¤„ç†ç¨‹åºæˆ–è€… effects ä¸­è¯»å–å’Œå†™å…¥ refã€‚**

```js
function MyComponent() {
  // ...
  useEffect(() => {
    // âœ… ä½ å¯ä»¥åœ¨ effects ä¸­è¯»å–å’Œå†™å…¥ ref
    myRef.current = 123;
  });
  // ...
  function handleClick() {
    // âœ… ä½ å¯ä»¥åœ¨äº‹ä»¶å¤„ç†ç¨‹åºä¸­è¯»å–å’Œå†™å…¥ ref
    doSomething(myOtherRef.current);
  }
  // ...
}
```
