# 事件循环

- [事件循环](#事件循环)
  - [**执行顺序规则：**](#执行顺序规则)
  - [**具体流程：**](#具体流程)
  - [**详细解释：**](#详细解释)
    - [1. **第一轮循环（初始执行）**](#1-第一轮循环初始执行)
    - [2. **检查微任务队列**](#2-检查微任务队列)
    - [3. **下一轮循环**](#3-下一轮循环)
  - [**常见的任务类型：**](#常见的任务类型)
  - [**重要特性：**](#重要特性)

在 JavaScript 的事件循环（Event Loop）中，执行顺序是：

## **执行顺序规则：**

1. **先执行当前宏任务**
2. **然后执行当前宏任务产生的所有微任务**
3. **接着执行下一个宏任务**

## **具体流程：**

```javascript
// 示例代码
console.log('1'); // 同步代码，立即执行

setTimeout(() => {
    console.log('2'); // 宏任务
}, 0);

Promise.resolve().then(() => {
    console.log('3'); // 微任务
});

console.log('4'); // 同步代码，立即执行

// 输出顺序：1 → 4 → 3 → 2
```

## **详细解释：**

### 1. **第一轮循环（初始执行）**

- 执行整体 script 代码（这是一个宏任务）
- 遇到同步代码立即执行：输出 `1` 和 `4`
- 遇到微任务（Promise.then）放入微任务队列
- 遇到宏任务（setTimeout）放入宏任务队列

### 2. **检查微任务队列**

- 当前宏任务执行完毕后，立即执行所有微任务
- 输出 `3`

### 3. **下一轮循环**

- 从宏任务队列中取出下一个宏任务执行
- 输出 `2`

## **常见的任务类型：**

| 任务类型 | 示例 |
| --------- | ------ |
| **宏任务** | script整体代码、setTimeout、setInterval、I/O操作、UI渲染、requestAnimationFrame（浏览器） |
| **微任务** | Promise.then/catch/finally、async/await、MutationObserver、process.nextTick（Node.js） |

## **重要特性：**

1. **微任务优先级更高**：每个宏任务执行完后，会清空整个微任务队列
2. **微任务会阻塞**：如果微任务中又产生了新的微任务，会继续执行直到微任务队列为空
3. **事件循环结构**：

   ```txt
   执行一个宏任务
   ↓
   执行所有微任务
   ↓
   渲染（如果需要）
   ↓
   执行下一个宏任务
   ```

记住这个简单规则：**"一个宏任务，所有微任务"** 的循环模式。
