# virtual dom

`virtual dom` 是一种编程概念，它将当前的 `ui` 描绘成一颗树存放在内存中，这颗树与实际的 `DOM` 是相对应的。`React` 会使用 `ReactDOM` 等库将这棵树与实际的 DOM 树进行同步。

`virtual dom` 不一定比操作真实 DOM 快

## 过程

1. 首先对我们将要插入到文档中的 DOM 树结构进行分析，使用 js 对象将其表示出来，比如一个元素对象，包含 TagName、props 和 Children 这些属性。然后我们将这个 js 对象树给保存下来，最后再将 DOM 片段插入到文档中。
2. 当页面的状态发生改变，我们需要对页面的 DOM 的结构进行调整的时候，我们首先根据变更的状态，重新构建起一棵对象树，然后将这棵新的对象树和旧的对象树进行比较，记录下两棵树的的差异。
3. 最后将记录的有差异的地方应用到真正的 DOM 树中去，这样视图就更新了。

我认为 Virtual DOM 这种方法对于我们需要有大量的 DOM 操作的时候，能够很好的提高我们的操作效率，通过在操作前确定需要做的最小修改，尽可能的减少 DOM 操作带来的重流和重绘的影响。其实 Virtual DOM 并不一定比我们真实的操作 DOM 要快，这种方法的目的是为了提高我们开发时的可维护性，在任意的情况下，都能保证一个尽量小的性能消耗去进行操作。

## 优缺点

### 优点

1. 降低浏览器性能消耗
   1. 因为Javascript的运算速度远大于DOM操作的执行速度，因此，运用patching算法来计算出真正需要更新的节点，最大限度地减少DOM操作，从而提高性能。
2. diff算法,减少回流和重绘
   1. 通过diff算法，优化遍历，对真实dom进行打补丁式的新增、修改、删除，实现局部更新，减少回流和重绘。
3. 跨平台
   1. 虚拟 DOM 本质上是 JavaScript 对象，而 DOM 与平台强相关，相比之下虚拟 DOM ，可以进行更方便地跨平台操作，例如：服务器渲染、weex 开发等等

other：

1. 减少实际DOM的操作  
   直接操作实际DOM的代价很高，因为DOM操作需要浏览器重新计算布局和绘制。通过使Virtual DOM，React可以减少实际DOM的操作次数，从而提高应用程序的性能。
2. 提高渲染速度  
   React使用Virtual DOM来比较前后两个状态之间的差异，并且只更新需要更新的分。这意味着React不需要重新渲染整个页面，而只需要重新渲染变化的部分，从而高渲染速度。
3. 更好的跨平台兼容性  
   Virtual DOM可以用于任何JavaScript运行环境，包括Web浏览器、Node.js等。这得React可以更容易地在不同的平台上进行开发和部署，从而提高了跨平台兼容性。

### 缺点

1. 首次显示要慢些
   1. 首次渲染大量DOM时，由于多了一层虚拟DOM的计算, 会比innerHTML插入慢
